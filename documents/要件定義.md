# 要件定義

## 概要
### 1. ゲームコンセプト (Game Concept)
| 項目 | 内容 |
| :--- | :--- |
| **タイトル** | NewSim (仮) |
| **ジャンル** | 本格派経営・経済シミュレーション |
| **プラットフォーム** | Local PC |
| **ネットワーク要件** | None (Offline only) |
| **ターゲット国** | 日本 (UI表示やソースコード内のコメントは日本語) |
| **概要** | 架空世界における一人の経営者として、リアルな経済・経営シミュレーションを行う。企業の財務諸表を見れたり、NPCの育成要素などが売り。 |

### 2. システムアーキテクチャ (System Architecture)
- **アプリケーション層**: Python
- **データベース層**: SQLite
- **フロントエンド層**: 未定

### 3. ゲームサイクル (Game Cycle)
- **時間単位**: 1週間 (ターン制)
#### 1. プレイヤーフェーズ
プレイヤーによる意思決定・行動入力
- 経営判断
- 投資決定
- 人事発令
- 生産計画

#### 2. シミュレーションフェーズ
1. NPC企業の意思決定 (AIによる競合・取引行動)
2. その週の発揮能力の確定（バフ・デバフの確定）
3. B2B取引処理フェーズ
4. B2C取引処理フェーズ
5. 人事処理フェーズ
6. その他処理フェーズ（開発進捗、金銭、ステータス変化など）
7. 週次結果の集計
8. データベース更新
9. 週次サマリ・ニュースの作成と表示

### 4. 特徴 (Features)
- **NPC企業**: NPCがCEOを務める企業。NPCのCEOはプレイヤーと同様に利益最大化やシェア拡大を目指して自律的に活動する企業群。
- **シミュレーション忠実度**: データの細かさとリアリティを最重視。シミュレーターとしての精度を高める。
- **UI**: 世界の情勢やニュース、大量のデータとパラメータを直感的に閲覧・操作できるUI。イメージはFootballManagerシリーズのような、サイドメニュー＋メインエリアの構成。
 
## NPC
### 概要
世界には大量のNPCが存在。全員が企業の従業員または従業員候補である。 
NPCには能力値があり、それに基づいて意思決定・業務遂行を行う。プレイヤーに能力値はない。

### ライフサイクル
- **フロー**: 22歳(新卒) → 就職・配属 → 業務・成長 → (解雇/離職) → 転職 → 66歳定年
- **加齢ルール**: NPCは22歳で労働市場に生成され、11年で66歳（13週で1歳加算）に達して労働市場から引退する
- **天才メカニズム**: 22歳で生成時、稀に「天才」が出現（初期能力が高い）

### 労働市場
- **初期状態**: 失業率5%程度で生成
- **補充**: 定年引退数と同数の新卒を補充

### 能力定義 (Ability Definitions)
#### 能力一覧
| 能力名 | 効果 | 成長 | 範囲 |
| :--- | :--- | :--- | :--- |
| **勤勉さ** (Diligence) | 企業能力の安定性 | 固定 | 0-100 |
| **マネジメント** (Management) | 企業能力へのバフ・デバフ | 業務で微増、部長補佐で中増 | 0-100 |
| **適応力** (Adaptability) | NPC能力の成長速度 | 固定 | 0-100 |
| **店舗運営力** | 企業能力の店舗運営力 | 業務で中増 | 0-100 |
| **生産力** | 企業能力の生産力 | 生産業務従事で中増 | 0-100 |
| **開発力** | 企業能力の開発力 | 開発業務従事で中増 | 0-100 |
| **営業力** | 企業能力の営業力 | 営業業務従事で中増 | 0-100 |
| **人事力** | 企業能力の人事力 | 人事業務従事で中増 | 0-100 |
| **広報力** | 企業能力の広報力 | 広報業務従事で中増 | 0-100 |
| **経理力** | 企業能力の経理力 | 経理業務従事で中増 | 0-100 |
| **役員適正** (Executive) | CxO意思決定正確性 | 役職に応じて成長（初期値バラつき大） | 0-100 |
| **忠誠度** (Loyalty) | 転職判定 | 環境により毎週増減（初期50） | 0-100 |
| **業界適性** (Industry Aptitude) | 生産・店舗・営業力へのバフ | 生成時は0.1。業務に携わると13週程度で1.0に達する（適応力の影響を受ける）。1.0から2.0に達するのには260週（5年）程度かかる。 | 0.1-2.0 |

#### 能力値の配分
0-100範囲の能力値について詳細化する
| 能力値 | 説明 |
| :--- | :--- | 
| 0~20 | 業務につかせるのは不安レベル |
| 21~40 | 平均以下の能力値 |
| 41~60 | 平均的な能力値　業界基準の業務効率は能力50を前提にしている |
| 61～80 | 大きな戦力となる能力値　ベテラン |
| 81~90 | エース級。2:6:2の上の2。初期値か適応力が高くないとたどり着かない |
| 91~100 | めったに現れない伝説級。初期値と適応力両立で初めてたどり着ける |

#### 能力の初期値と成長
- 初期生成時は、0～40の範囲で生成される。（天才は30~60で生成）
- 生産部署に配属されている適応力50の従業員は、毎週0.05ずつ生産能力が成長する。
  - 適応力が100なら、0.1ずつ成長する。
  - 適応力が0なら成長が0.025ずつ成長する。
  - ほかの部署ならその部署に対応する能力が伸びる
  - マネジメント能力は、業務能力の半分だけ成長する
- 部長補佐or部長職に就いている適応力50の従業員は、毎週0.05ずつマネジメント能力が成長する。（適応力の計算は生産能力と同じ）
- 役員適正能力は、部長職orCxOに就いている場合のみ成長する。適応力50なら0.1ずつ成長する。

#### 配属と役職
- すべての企業に下記の部署が存在する（業態によって0人の部署もある）
  - 生産部
  - 営業部
  - 開発部
  - 人事部
  - 広報部
  - 経理部
- NPCは部署に配属されることで、その能力を発揮する
- すべての部署に下記の役職が存在する
  - 平社員
  - 部長補佐（マネジメント能力の育成用。マネジメント能力の発揮はしない）
  - 部長（マネジメント能力を発揮してバフデバフをかける）
### 給与
- 生産力開発力営業力人事力広報力経理力の内、最も高い能力値によって希望給与が変わる。
- 同じ能力値でもNPCによって希望給与が変わる。
- 基準は、最も高い能力値が50の時年収400万円。
- 希望給与と忠誠度の関係性について、能力が上がるたびに更改するのはゲームとして成立しないので要検討【未定義】

### NPCと人事能力の関係性
- NPCの能力値は真値としてDBに保存された値が本来の能力値。企業能力や店舗能力に影響を与えるのは真値。
- しかし、プレイヤーやNPCCEOは、真値を認知することはできない。（UI上も真値は表示されない）ランダムで誤差がでる。
  - 企業の人事能力が高いと、誤差範囲が狭くなる（人事力100だと、真値を含む4の範囲で表示される。真値50の能力値が、48～52のいずれかで表示される。）
  - 企業の人事能力が低いと、誤差範囲が広くなる（人事力0だと、真値を含む40の範囲で表示される。真値50の能力値が、30~70のいずれかで表示される。）
- 企業の人事能力が高いと、従業員の忠誠度が上がりやすい
- 企業の人事キャパシティが要求を下回っていると、従業員の忠誠度が毎週下がっていく
- 要求＝50×全従業員数の7分の1　キャパシティ＝人事部全員の人事能力の合計　・・・つまり、人事能力50の人事部員が管理できる他部署従業員は6人である。

### 採用フロー
- n週目（意思決定フェーズ）：労働市場には常に「無職」「転職希望者」の情報（能力値、希望給与）が公開されている（表示/認知される能力値は人事能力依存の数値）
- n週目（意思決定フェーズ）：企業は、労働市場のNPCに契約オファーを出す
- n週目（人事処理フェーズ）：オファーされたNPCは、オファー内容によって受諾か拒否か決める　受諾された場合は企業に即所属する。
- n+1週目（意思決定フェーズ）：企業はNPCの配属をすることができるようになる

### 離職・転職フロー
- 忠誠度が低いと、ランダムで転職希望を出して労働市場に売り出すことがある。
- 忠誠度が著しく低いと、他の企業からのオファーを待たずに離職することがある。
- 転職あるいは離職したNPCに対して、所属元企業は1年間オファーを出すことはできない（即出戻り防止）

## 企業
### 概要
- NPC企業：プレイヤーおよびNPCは「メーカー」または「小売り」のCEOとして参加する。
- システム企業：部品や素材を提供する企業。プレイヤーやNPC企業の意思決定に応じて部品や素材を無限に提供する。ただし、システム企業も多数存在し、それぞれに指向性（高級、廉価、中間）や、プレイヤーおよびNPC企業との関係性（関係性がいいと安くなる）がある。

### ライフサイクル
起業 → 事業運営・拡大 → 買収/倒産 → 消滅

### 新陳代謝 (Metabolism)
買収や倒産で企業数が減ると、市場の需要を満たすために労働市場にいる役員適正力のあるNPCをCEOに据えて新たな会社が設立される。

### Player vs NPC
プレイヤー企業とNPC企業は同じデータ構造、意思決定の選択肢を持っていて、同条件でシミュレーションされる。意思決定をプレイヤーが行うか、ゲーム内のNPC CEOが行うかだけの違い。

### 企業能力定義 (Capability Definitions)
| 能力名 | 決定要因 | 高い場合の効果 | 低い場合の効果 |
| :--- | :--- | :--- | :--- |
| **安定性** | 所属NPCの勤勉さ平均 | 企業能力を安定発揮 | ランダムでデバフ発生 |
| **生産力**| 生産部NPCの生産力平均<br>＋部長マネジメント力 | 生産効率上昇 | 生産効率低下 |
| **生産キャパシティ** | 生産部NPCの生産力合計 | なし（要求満たす） | 生産力にペナルティ |
| **開発力** | 開発部NPCの開発力平均<br>＋部長マネジメント力 | 商品設計書のステータス向上 | 商品設計書のステータス低下 |
| **開発キャパシティ** | 開発部NPCの開発力合計 | なし（要求満たす） | 開発力にペナルティ |
| **営業力** | 営業部NPCの営業力平均<br>＋部長マネジメント力 | B2B取引価格有利 | B2B取引価格不利 |
| **営業キャパシティ** | 営業部NPCの営業力合計 | なし（要求満たす） | 営業力にペナルティ |
| **人事力** | 人事部NPCの人事力平均<br>＋部長マネジメント力 | NPC能力表示誤差縮小<br>忠誠度上昇 | NPC能力表示誤差拡大<br>忠誠度低下 |
| **人事キャパシティ** | 人事部NPCの人事力合計 | なし（要求満たす） | 人事力にペナルティ |
| **広報力** | 広報部NPCの広報力平均<br>＋部長マネジメント力 | 広報投資効果向上 | 広報投資効果低下 |
| **広報キャパシティ** | 広報部NPCの広報力合計 | なし（要求満たす） | 広報力にペナルティ |
| **経理力** | 経理部NPCの経理力平均<br>＋部長マネジメント力 | 今のところなし | なし |
| **経理キャパシティ** | 経理部NPCの経理力合計 | なし（要求満たす） | 経理力にペナルティ |
| **ブランド力** | 累計売上台数・広報出稿 | 販売増 | 販売減 |

## 商品開発
メーカーは商品開発を行い、自社製品の設計書を作成する。

### 開発フロー
- n週目　開発開始
  - 業界を決める
  - サプライヤーリストから、材料の発注先を決める
  - コンセプトと生産効率のバランスを決める（高くて貴重な商品をつくるのか、安くて量産可能な商品をつくるのか）
    - コンセプト特化
    - コンセプト重視
    - バランス重視
    - 生産効率重視
    - 生産効率特価
  - 開発開始
- n+4週目　開発完了
  - 商品設計書ステータスの確定
  - NPCがメーカー希望小売価格の決定
  - 商品設計書として蓄積
  - 生産候補として選択できるようになる

### 商品設計書が持つステータス
| 項目 | 範囲 | 説明 |
| :--- | :--- | :--- |
| **材料性能** | 1.0-5.0 | 製品の材料の性能。車のように部品が7種ある場合は7つのステータスになる。 |
| **コンセプト** | 1.0 - 5.0 | 製品全体の魅力。高いほど売れやすい。|
| **生産効率** | 1.0 - 2.0 | 生産効率。高いほど1週間に多く作れる。|
| **基準価格** | 業界による(車の場合3,000,000～10,000,000円) | 材料性能、コンセプトからシステムが算出する。顧客はこの価格と実際の売値の差分を購買判断に用いる | 

## 広告
企業は資金を投じて広告を打つことができる。広告効果は広報部の能力（広報力）に依存する。
広告対象は、Web、TV、看板、ネーミングライツなど様々あり、費用は効果がそれぞれ異なる

### 広告の種類
| 種類 | 対象 | 効果 | 実施可能企業 |
| :--- | :--- | :--- | :--- |
| **ブランド広告** | 企業 | 企業の「ブランド力」が上昇する。 | メーカー、小売 |
| **商品広告** | 特定の商品設計書 | 対象商品の「認知度」が上昇する。 | メーカー |

### 広告の効果と減衰
- 広告を打つと、対象のステータス（ブランド力 or 認知度）が即時上昇する。
- 上昇幅は、投入金額 × 広報力係数 で決定される。
- ブランド力および認知度は、毎週少しずつ自然減衰する（忘却）。継続的な投資が必要。

## 生産
- 自社製品の設計書を元に、生産計画を立てる。
- 1人週で生産できる数は、業界の基準生産効率、商品設計書の生産効率、企業の生産能力によって決まる。
  - 例：自動車の場合・・・
    - 業界の基準生産効率0.17台/NPC/週
    - 商品設計書の生産効率が1.0、企業の生産能力が50なら、1人週で0.17台生産できる。
- 生産した製品はメーカー在庫に入るが、在庫保持による維持費はかからないものとする
- 材料の事前確保（在庫）は不要。生産完了時に原価として自動的に支出される。

## B2B取引
### サプライヤーとメーカーのB2B取引
- サプライヤーはシステム企業のため、素材や部品を無限に提供する。
- 契約や事前取引は存在せず、メーカーは、商品設計書で定義された材料代を生産完了時に原価として自動的に支出。
- サプライヤーは材料区分（車ならエンジン、安全機器など）ごとに複数社存在しており、それぞれが指向性（高価、廉価、中間）を持っている。
  - 材料区分×指向性×競合分なので、かなりの数のサプライヤーが存在するはず。車業界なら最低でも7×3×2=42社。
- メーカーとサプライヤーの関係性、メーカーの営業力によって仕入れ金額が変わる

### メーカーと小売店のB2B取引
- 取引フローは下記の通り
  - n週目（意思決定フェーズ）：メーカーの製品在庫はB2B市場に常時公開されている。
  - n週目（意思決定フェーズ）：小売りはB2C市場の需要を予測し、公開されたメーカーの製品在庫から買付注文を実施
  - n+1週目（意思決定フェーズ）：メーカーは買付注文に対して回答。買付が成立すると、
  - n+1週目（B2B処理フェーズ）：メーカー在庫から小売在庫に移動する。
  - n+1週目（B2B処理フェーズ）：現金残高が小売からメーカーに移動。※業界ごとに定められた小売取り分を除いた額。
  - n+1週目（B2C処理フェーズ）：小売り在庫に製品が入った週から店舗に並び、その週のシミュレーションから顧客による購買が始まる。
- 小売りも在庫保持による維持費はかからない。あくまで需要予測のみを判断基準にメーカーから仕入れを行う。

## 店舗
- 小売りは店舗物件を賃貸もしくは購入することで在庫を売ることができるようになる。
- 店舗物件が持つステータスは下記の通り
| 項目 | 単位 | 説明 |
| :--- | :--- | :--- |
| 面積 | 1人～100人 | 店舗配属のNPCの許容力 |
| アクセススコア | S,A,B,C,D | 顧客の購買判断につながる |
| 賃料 | ○○円/週 | 面積1人分、アクセススコアBの物件は35,000円　 |
- 店舗配属のNPCは店舗物件ごとにアサインする必要があるが、店舗の許容力分のNPCしか店舗では働けない（事業所不足のペナルティ）。
- 小売りの企業在庫がそのまま全店舗に並ぶ。店舗在庫の概念はなし。
- アクセススコアによる賃料の増減幅は、アクセススコアによる需要の増減に対して大幅な損得が発生しないよう決定する【未定義】
- 店舗物件に配属されたNPCの能力によって、店舗ごとの能力値が決まる 
- 店舗物件は、賃貸か購入か選べる

| 能力名 | 決定要因 | 高い場合の効果 | 低い場合の効果 |
| :--- | :--- | :--- | :--- |
| **店舗運営力** | 店舗NPCの店舗運営力平均<br>＋部長マネジメント力 | 店舗魅力増（購買に影響）・店舗支出減 | 店舗魅力増（購買に影響）・店舗支出増 |
| **店舗運営キャパシティ** | 店舗NPCの店舗運営力合計<br>＋部長マネジメント力 | 1週間に売れる台数が増える | 1週間に売れる台数が減る |


## B2C需要
#### 総需要決定
- **基本需要**: 市場規模に基づく基本値（業界ごとに固定値で設定）
- **変動要因**:
  - 景気動向指数（0.8～1.2倍）
  - 週次ランダム変動（±5%）

#### 供給のスコアリング
- 小売の全企業在庫を下記の要素でスコアリング（製品スコア）
  - 製品の魅力度
    - 材料性能
    - コンセプト
    - 商品認知度（商品広告により上昇）
    - 売値そのもの（基準価格関係なし）
    - 基準価格と売値の乖離
  - メーカーのブランド力（信頼性係数）
- 店舗の魅力度を下記の要素でスコアリング（店舗スコア）
    - 小売のブランド力
    - 小売の店舗運営力
    - 店舗のアクセススコア

#### 総需要をスコアシェア率に応じて分配
- 企業在庫の総合スコア：その企業で一番高い店舗スコア×製品スコア×乱数（多少のブレ。毎週同じものが売れるわけではない）
- 総合スコアのシェア率に基づいて、総需要を一括分配する
- 1店舗で売れる商品の数が店舗キャパシティによって限られている点を盛り込む
- 在庫切れが発生した場合、余剰需要を再分配する

## 工場
- 生産部の従業員数に応じて工場物件が必要。
- 工場物件が持つステータスは面積（○○人分）と賃料のみ。
- 賃料は、1人分あたり30,000円（週）
- 工場不足のペナルティ：
  - 持っている工場物件分しか従業員は働けない（あふれた従業員の能力は企業のキャパシティ系能力に加算されない。）
- 工場物件は賃貸か購入か選べる

## オフィス
- 営業部、人事部、開発部、経理部、広報部の従業員数に応じてオフィス物件が必要
- 工場とステータスは同じ
- 賃料は、1人分あたり40,000円（週）
- オフィス不足のペナルティ：
  - 基本的に工場と同じだが、あふれる従業員は各部署平等な割合で算出される。
- オフィス物件は賃貸か購入か選べる


## 業界
このゲームでは複数の業界を取り扱い、他業界進出や買収によるノウハウ吸収などの要素を実装予定だが、開発初期段階としてまずは1業界のみでスタートする。

### 自動車業界
## 収益構造
### 小売（ディーラー）
- **1台あたり取り分**: 300,000円（販売価格の10%）

**内訳**
| 項目 | 金額 (円) | 比率 | 備考 |
| :--- | :--- | :--- | :--- |
| 店舗人件費 | 120,000 | 40.0% | 1.56人週 → 0.64台/NPC/週 |
| 店舗販促費 | 30,000 | 10.0% | |
| 営業部人件費 | 0 | 0.0% | 仕入れ担当 |
| 人事部人件費 | 22,500 | 7.5% | 0.29人週 (管理対象=約1.7人週) |
| 経理部人件費 | 15,000 | 5.0% | 0.20人週 |
| 店舗運営費 | 75,000 | 25.0% | 店舗賃料・光熱 |
| オフィス運営費 | 28,500 | 9.5% | 賃料・光熱 |
| 倉庫運営費 | 0 | 0.0% | |
| **ディーラー利益** | **9,000** | **3.0%** | |

### メーカー（OEM）
- **1台あたり売上**: 2,700,000円

**部品構成 (Parts Breakdown)**
| 部品名 | 金額 (円) |
| :--- | :--- |
| エンジン | 240,000 |
| 走行パーツ | 240,000 |
| 足回り | 180,000 |
| 安全機器 | 72,000 |
| 補機類 | 48,000 |
| 車体 | 240,000 |
| インテリア | 180,000 |

**コスト内訳**
| 項目 | 金額 (円) | 比率 | 備考 |
| :--- | :--- | :--- | :--- |
| 工場人件費 | 450,000 | 16.67% | 5.85人週 → 0.17台/NPC/週 |
| 開発部人件費 | 250,000 | 9.26% | 3.25人週 |
| 営業部人件費 | 50,000 | 1.85% | |
| 工場運営費 | 200,000 | 7.41% | |
| 人事部人件費 | 135,000 | 5.00% | |
| 経理部人件費 | 60,000 | 2.22% | |
| オフィス運営費 | 120,000 | 4.44% | |
| 倉庫運営費 | 100,000 | 3.70% | |
| **メーカー利益** | **135,000** | **5.00%** | |


## CxOシステム
- 部長はあくまでマネジメント能力の発揮要員。
- その上位存在として、CxO（人事ならCHRO、生産ならCOO、開発ならCPO）を配置できる。
- CEOは、CxOの配置、CxOにどの意思決定を委任するかを意思決定する
- CxOの意思決定は、役員適正と該当業務の対応能力（COOなら生産力）によって精度が変わるため、将来の幹部候補は早めに部長にして役員適正を鍛えるなどのプレイングが重要。

## 銀行融資
- **信用格付け**: 黒字期間、保有資産価値（自社ビル・工場）、現預金に基づく。
- **借入限度額**: 信用格付けにより借入限度額と金利（年利1%～15%）が変動。
- **返済**: 週次で利払い発生。元本は期限一括または分割返済。

## 倒産
- **条件**: 資金がマイナスになり、かつ銀行からの追加借入も不可能な状態で週をまたぐ。
- **処理**: プレイヤーはゲームオーバー。NPC企業は資産売却（M&A）または解散・清算。
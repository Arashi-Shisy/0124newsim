# 命令
現在のPython製シミュレーションゲーム「NewSim」を大幅にリファクタリングし、**「複数業界・多事業部制」**に対応した経営シミュレーションへ拡張してください。

# 目的
- 自動車以外の業界（家電など）を追加し、企業が複数の異なる事業（事業部）を持つ「総合商社プレイ」を可能にする。
- 業界ごとの特性（需要規模、開発期間、製品構造）を細かく設定可能にする。

# 新しい仕様・要件

## 1. 業界構造の階層化 (3階層)
現状の「業界 -> 商品」構造を改め、**「業界 (Industry) -> カテゴリ (Category) -> 商品 (Product)」** の3階層構造としてください。
また、開発期間や需要などのパラメータはカテゴリ単位で設定できるようにします。

**定義例 (`src/gamebalance.py` のイメージ):**
```python
INDUSTRIES = {
    "automotive": {
        "name": "自動車業界",
        "categories": {
            "sedan": {
                "name": "セダン",
                "base_demand": 1000, # 週次需要
                "development_duration": 48, # 開発期間(週): 長め
                "parts": [...] # 部品構成
            }
        }
    },
    "home_appliances": { # 新規追加
        "name": "家電業界",
        "categories": {
            # 家電業界全体で自動車の約10倍の需要(10,000台)になるようカテゴリで配分
            "washing_machine": {
                "name": "洗濯機",
                "base_demand": 4000,
                "development_duration": 13, # 要件: 3ヶ月 (13週)
                "parts": [...]
            },
            "refrigerator": {
                "name": "冷蔵庫",
                "base_demand": 6000,
                "development_duration": 13, # 要件: 3ヶ月 (13週)
                "parts": [...]
            }
        }
    }
}
```

## 2. 事業部制 (Divisional Organization) の導入
企業組織を「全社一括」から**「事業部制」**へ変更してください。間接部門は全社共通とし、直接部門は事業部配下とします。

- **組織構造**:
  - **企業 (Company)**
    - **共通部門 (Corporate Functions)**: 全事業部を横断して支援。
      - 該当部署: 人事部 (HR), 広報部 (PR), 経理部 (Accounting)
    - **事業部 (Divisions)**: 特定の業界・カテゴリを担当。企業は複数の事業部を持てる（例：自動車事業部、家電事業部）。
      - 該当部署: 生産部 (Production), 開発部 (Development), 営業部 (Sales), 店舗部 (Store)

# 依頼する作業内容

## Step 1: `src/gamebalance.py` の再設計
`INDUSTRIES` 辞書をネスト構造（Industry > Category）へ変更し、家電業界の定義を追加してください。
- カテゴリごとに `base_demand`（需要）と `development_duration`（開発期間）を定義すること。
- 家電の需要は自動車の約10倍、開発期間はデフォルト13週とすること。

## Step 2: データベーススキーマの拡張 (`src/database.py`)
- **`divisions` テーブル**: 新規作成 (`id`, `company_id`, `name`, `industry_key` 等)。
- **既存テーブルの変更**:
  - `npcs`: `division_id` カラム追加。共通部門（HR等）の場合は `NULL`、事業部所属（生産等）の場合はIDが入る。
  - `product_designs`: `category_key` および `division_id` カラム追加。
  - `facilities`: `division_id` カラム追加（工場や店舗は特定の事業部に紐づく）。
  - `inventory`: `division_id` カラム追加（在庫は事業部単位で管理）。

## Step 3: ロジックの修正 (`src/simulation.py`, `src/npc_logic.py`)
- **能力計算 (`calculate_capabilities`)**:
  - これまで「会社全体」で集計していましたが、「事業部ごと」に能力（生産力、営業力など）を集計するように変更してください。
  - 共通部門（人事・広報・経理）の能力は、全社の係数として算出してください。
- **生産・開発・販売**:
  - 各アクションは `division_id` を指定して行うように変更してください。
  - 需要と供給のマッチング（B2C）は、`product_designs` の `category_key` に紐づく需要 (`base_demand`) に基づいて行ってください。

## Step 4: シードデータの修正 (`src/seed.py`)
`run_seed()` を修正し、以下の構成で初期データを生成してください。
- **プレイヤー企業**: 「自動車事業部」と「家電事業部」の両方を持つ総合メーカーとして生成する。
- **NPC企業**: 専業メーカー（自動車のみ、家電のみ）や、小売店（家電量販店など）を生成。
- 各NPCは適切な `division_id` に所属させること。

# 出力形式
- 変更が必要なファイルの具体的なコード修正案（特にDBスキーマ変更と能力計算ロジック）。
- 事業部制導入に伴い、UI（ダッシュボードや生産画面）で「事業部切り替え」が必要になる箇所のリストアップ。